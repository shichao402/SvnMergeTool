{
  "typeId": "backup_wc",
  "name": "备份工作副本",
  "description": "将工作副本备份到指定目录，用于合并前的安全备份",
  "icon": "create_new_folder",
  "color": "teal",
  "category": "工具",
  "inputs": [
    {
      "id": "in",
      "name": "输入",
      "description": "接收上游数据"
    }
  ],
  "outputs": [
    {
      "id": "success",
      "name": "成功",
      "description": "备份成功"
    },
    {
      "id": "failure",
      "name": "失败",
      "description": "备份失败"
    }
  ],
  "params": [
    {
      "key": "backupDir",
      "name": "备份目录",
      "type": "string",
      "defaultValue": "/tmp/svn_backups",
      "description": "备份文件存放目录"
    },
    {
      "key": "compress",
      "name": "压缩备份",
      "type": "bool",
      "defaultValue": true,
      "description": "是否压缩备份文件"
    }
  ],
  "executor": {
    "type": "shell",
    "command": "mkdir -p ${config.backupDir} && BACKUP_NAME=\"backup_$(date +%Y%m%d_%H%M%S)_r${job.currentRevision}\" && if [ \"${config.compress}\" = \"true\" ]; then tar -czf ${config.backupDir}/$BACKUP_NAME.tar.gz -C $(dirname ${job.targetWc}) $(basename ${job.targetWc}) && echo \"backup_file=${config.backupDir}/$BACKUP_NAME.tar.gz\"; else cp -r ${job.targetWc} ${config.backupDir}/$BACKUP_NAME && echo \"backup_file=${config.backupDir}/$BACKUP_NAME\"; fi",
    "timeout": 600,
    "outputParser": {
      "backupFile": "regex:backup_file=(.+)"
    },
    "portMapping": {
      "exitCode": {
        "0": "success",
        "*": "failure"
      }
    }
  }
}
